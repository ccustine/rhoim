# RHOIM Model Downloader - Init Container (Public Base Image)
# Purpose: Download LLM models from HuggingFace Hub to shared volume
# Uses publicly accessible base image - no Red Hat login required

FROM docker.io/redhat/ubi9:latest

# Metadata
LABEL name="rhoim-model-downloader" \
      version="0.2.0" \
      summary="RHOIM Model Downloader Init Container" \
      description="Downloads LLM models from HuggingFace Hub for RHOIM inference server" \
      io.k8s.display-name="RHOIM Model Downloader" \
      io.openshift.tags="ai,llm,model,downloader"

USER 0

# Install Python 3.11
RUN dnf install -y python3.11 python3.11-pip && dnf clean all

# Install HuggingFace Hub CLI and dependencies
RUN python3.11 -m pip install --no-cache-dir \
    huggingface-hub[cli]==0.20.3 \
    requests \
    tqdm

# Copy download script
COPY download-model.py /usr/local/bin/download-model.py
RUN chmod +x /usr/local/bin/download-model.py

# Create models directory
RUN mkdir -p /models && chown -R 1001:0 /models

# Run as non-root
USER 1001

# Set working directory
WORKDIR /models

# Entry point is the download script
ENTRYPOINT ["/usr/local/bin/download-model.py"]
